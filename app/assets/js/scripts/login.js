const validUsername=/^[a-zA-Z0-9_]{1,16}$/,basicEmail=/^\S+@\S+\.\S+$/,loginCancelContainer=document.getElementById("loginCancelContainer"),loginCancelButton=document.getElementById("loginCancelButton"),loginEmailError=document.getElementById("loginEmailError"),loginUsername=document.getElementById("loginUsername"),loginPasswordError=document.getElementById("loginPasswordError"),loginPassword=document.getElementById("loginPassword"),checkmarkContainer=document.getElementById("checkmarkContainer"),loginRememberOption=document.getElementById("loginRememberOption"),loginButton=document.getElementById("loginButton"),loginForm=document.getElementById("loginForm");let lu=!1,lp=!1;const loggerLogin=LoggerUtil1("%c[Login]","color: #000668; font-weight: bold");function showError(n,e){n.innerHTML=e,n.style.opacity=1}function shakeError(n){1==n.style.opacity&&(n.classList.remove("shake"),n.offsetWidth,n.classList.add("shake"))}function validateEmail(n){n?basicEmail.test(n)||validUsername.test(n)?(loginEmailError.style.opacity=0,lu=!0,lp&&loginDisabled(!1)):(showError(loginEmailError,Lang.queryJS("login.error.invalidValue")),loginDisabled(!0),lu=!1):(lu=!1,showError(loginEmailError,Lang.queryJS("login.error.requiredValue")),loginDisabled(!0))}function validatePassword(n){n?(loginPasswordError.style.opacity=0,lp=!0,lu&&loginDisabled(!1)):(lp=!1,showError(loginPasswordError,Lang.queryJS("login.error.invalidValue")),loginDisabled(!0))}function loginDisabled(n){loginButton.disabled!==n&&(loginButton.disabled=n)}function loginLoading(n){n?(loginButton.setAttribute("loading",n),loginButton.innerHTML=loginButton.innerHTML.replace(Lang.queryJS("login.login"),Lang.queryJS("login.loggingIn"))):(loginButton.removeAttribute("loading"),loginButton.innerHTML=loginButton.innerHTML.replace(Lang.queryJS("login.loggingIn"),Lang.queryJS("login.login")))}function formDisabled(n){loginDisabled(n),loginCancelButton.disabled=n,loginUsername.disabled=n,(loginPassword.disabled=n)?checkmarkContainer.setAttribute("disabled",n):checkmarkContainer.removeAttribute("disabled"),loginRememberOption.disabled=n}loginUsername.addEventListener("focusout",n=>{validateEmail(n.target.value),shakeError(loginEmailError)}),loginPassword.addEventListener("focusout",n=>{validatePassword(n.target.value),shakeError(loginPasswordError)}),loginUsername.addEventListener("input",n=>{validateEmail(n.target.value)}),loginPassword.addEventListener("input",n=>{validatePassword(n.target.value)});let loginViewOnSuccess=VIEWS.landing,loginViewOnCancel=VIEWS.settings,loginViewCancelHandler;function loginCancelEnabled(n){n?$(loginCancelContainer).show():$(loginCancelContainer).hide()}loginCancelButton.onclick=n=>{switchView(getCurrentView(),loginViewOnCancel,500,500,()=>{loginUsername.value="",loginPassword.value="",loginCancelEnabled(!1),null!=loginViewCancelHandler&&(loginViewCancelHandler(),loginViewCancelHandler=null)})},loginForm.onsubmit=()=>!1,loginButton.addEventListener("click",()=>{formDisabled(!0),loginLoading(!0),AuthManager.addMojangAccount(loginUsername.value,loginPassword.value).then(n=>{updateSelectedAccount(n),loginButton.innerHTML=loginButton.innerHTML.replace(Lang.queryJS("login.loggingIn"),Lang.queryJS("login.success")),$(".circle-loader").toggleClass("load-complete"),$(".checkmark").toggle(),setTimeout(()=>{switchView(VIEWS.login,loginViewOnSuccess,500,500,()=>{loginViewOnSuccess===VIEWS.settings&&prepareSettings(),loginViewOnSuccess=VIEWS.landing,loginCancelEnabled(!1),loginViewCancelHandler=null,loginUsername.value="",loginPassword.value="",$(".circle-loader").toggleClass("load-complete"),$(".checkmark").toggle(),loginLoading(!1),loginButton.innerHTML=loginButton.innerHTML.replace(Lang.queryJS("login.success"),Lang.queryJS("login.login")),formDisabled(!1)})},1e3)}).catch(n=>{loginLoading(!1);let e;e=isDisplayableError(n)?(msftLoginLogger.error("Error while logging in.",n),n):(msftLoginLogger.error("Unhandled error during login.",n),{title:"Unknown Error During Login",desc:"An unknown error has occurred. Please see the console for details."}),setOverlayContent(e.title,e.desc,Lang.queryJS("login.tryAgain")),setOverlayHandler(()=>{formDisabled(!1),toggleOverlay(!1)}),toggleOverlay(!0)})});